## Bitrix Data Model Cheatsheet

> Ничего не правим в текущем пайплайне загрузки. Здесь только шпаргалка, к чему нужно подготовиться перед расширением визуализации.

### 1. Задачи (`tasks.task.list`)

| Поле в `select[]`                                                                                                                       | Что даёт                                                           | Зачем нужно                                             |
| --------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------ | ------------------------------------------------------- |
| `ID`, `TITLE`, `DESCRIPTION`, `STATUS`, `RESPONSIBLE_ID`, `CREATED_DATE`, `DEADLINE`, `START_DATE_PLAN`, `END_DATE_PLAN`, `CLOSED_DATE` | уже используем                                                     | базовые атрибуты                                        |
| `GROUP_ID`                                                                                                                              | числовой id рабочей группы (проекта)                               | группировка задач по проектам                           |
| `GROUP`                                                                                                                                 | вложенный объект с `id`, `name`, `opened`, `membersCount`, `image` | быстрый доступ к названию проекта без отдельного вызова |
| `PARENT_ID`                                                                                                                             | id родительской задачи (0 — верхний уровень)                       | построение иерархии задач/подзадач                      |
| `SE_SUBTASK`                                                                                                                            | массив детей (только при запросе конкретной задачи)                | не используем при массовой выборке, но полезно знать    |
| `SE_DEPENDS_ON`                                                                                                                         | массив зависимостей `[{ taskId, type, srcTaskId }]`                | линии зависимостей в диаграмме                          |

> Примечание: `SE_DEPENDS_ON` возвращается только если явно указать в `select[]`. Тип зависимости (`type`) соответствует семантике Finish-to-Start/Start-to-Start и т.д.

Если `SE_DEPENDS_ON` пустой, можно дополнительно вызывать `tasks.task.dependent.list` для конкретных задач (нужно минимум `taskId` и пагинация через `offset`/`limit`). Это пригодится, если Bitrix не отдаёт связи «в лоб».

### 2. Проекты/рабочие группы (`sonet_group.get`)

- Рабочие группы в Bitrix = проекты в текущей терминологии.
- Минимальный набор полей: `ID`, `NAME`, `DATE_CREATE`, `VISIBLE`, `OPENED`, `AVATAR`, `OWNER_ID`.
- Вызов: `sonet_group.get({ FILTER: { "ID": [list of GROUP_ID] }, SELECT: [ ... ] })`.
- Схема: сначала собрать все уникальные `groupId` из задач, затем одним запросом получить описания. Это не ломает существующий поток и не добавляет новых ручек.

### 3. Иерархия

- Любая задача с `PARENT_ID > 0` — подзадача. Родитель может быть как в том же проекте, так и без него (Bitrix не запрещает перемешивать).
- Корневые узлы строим так:
  - если `GROUP_ID ≠ 0` — верхний уровень «Проект → задачи».
  - если `GROUP_ID = 0` — сваливаем в секцию «Без проекта».
- При формировании дерева проверяем, что родитель действительно есть в текущем срезе (Bitrix может вернуть ссылку на задачу, к которой нет доступа).

### 4. Зависимости

- Значение `type` указывает тип связи (например, `FS`, `FF`, `SS`, `SF`). Для MVP можно трактовать всё как `Finish-to-Start`, а позже раскрасить.
- В `gantt-task-react` поле `dependencies` — массив id задач, от которых зависит текущая.
- Для критического пути понадобится рассчитать длину цепочки по зависимостям; пока достаточно сохранить сами связи.

### 5. Что нужно помнить

- Не трогаем и не переписываем существующий эндпоинт. Мы просто расширим `select[]` и добавим на выход дополнительные поля.
- Bitrix любит pagination. При добавлении `PARENT_ID`/`SE_DEPENDS_ON` не забываем про `start`/`next`.
- В рабочей группе может быть до 50k задач. При построении дерева держим в голове необходимость кешировать результаты и вычислять иерархию в памяти, чтобы не дёргать API повторно.

Эта заметка закрывает задачу «Задокументировать поля Bitrix для проектов, иерархий, зависимостей». Дальше — реализация по плану.
